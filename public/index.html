<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gemini API</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/default.min.css" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
    <script type="module">
        import { marked } from "https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js";
        window.onload = function () {
            hljs.highlightAll();
            marked.setOptions({
                highlight: function (code, lang) {
                    const language = hljs.getLanguage(lang) ? lang : "plaintext";
                    return hljs.highlight(code, { language }).value;
                },
            });

            async function sendMessage() {
                const userInput = document.getElementById("user-input").value;
                if (userInput.trim() === "") return;
                const selectedModel = document.getElementById("model-select").value;
                document.getElementById("loading-spinner").style.display = "block";
                const response = await fetch("/api/chat", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ input: userInput, model: selectedModel }),
                });
                const message = await response.text();
                document.getElementById("loading-spinner").style.display = "none";
                displayMessage(userInput, "user");
                displayMessage(message, "ai");
                document.getElementById("user-input").value = "";
            }

            document.getElementById("send-button").addEventListener("click", sendMessage);
            document.getElementById("user-input").addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    sendMessage();
                }
            });

            function displayMessage(text, sender) {
                const chatContainer = document.getElementById("chat-container");
                const messageDiv = document.createElement("div");
                messageDiv.classList.add("message", sender + "-message");
                const htmlText = marked(text);
                messageDiv.innerHTML = htmlText;
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        };
    </script>
</head>

<body>
    <div id="loading-spinner" style="display: none; text-align: center; padding: 10px">
        <i class="fas fa-spinner fa-spin"></i>
    </div>
    <div class="chat-container" id="chat-container"></div>
    <div class="input-container">
        <input type="text" id="user-input" placeholder="Type your message..." />
        <button id="send-button">Send</button>
        <select id="model-select">
            <option value="gemini-1.0-pro">Gemini 1.0 Pro</option>
            <option value="gemini-1.5-flash-latest" selected>Gemini 1.5 Flash</option>
            <option value="gemini-1.5-pro-latest">Gemini 1.5 Pro</option>
        </select>
    </div>
    <div class="footer">
        <p>
            <a href="https://ai.google.dev" target="_blank">Gemini API</a> may create unexpected outputs,
            please verify before proceeding. This UI is prepared by
            <a href="https://www.adistrim.me" target="_blank">adistrim</a>
        </p>
    </div>
</body>

</html>